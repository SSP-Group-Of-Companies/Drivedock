name: Scheduled Release to Main

on:
  schedule:
    # Runs every   5 minutes for testing purposes; adjust as needed
    - cron: "*/5 * * * *"
  workflow_dispatch: {} # allow manual trigger from the Actions tab

jobs:
  release:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: write

    env:
      # üîπ Testing setup
      BASE_BRANCH: feature/pdf-backend # "backend" branch
      SOURCE_BRANCH: feature/frontendPDF # "frontend" branch

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Configure git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: Fetch all branches
        run: git fetch origin

      - name: Merge $SOURCE_BRANCH into $BASE_BRANCH
        run: |
          git checkout $BASE_BRANCH
          git merge origin/$SOURCE_BRANCH --no-ff -m "Scheduled merge of $SOURCE_BRANCH into $BASE_BRANCH" || {
            echo "‚ùå Merge failed due to conflicts. Please resolve manually.";
            exit 1;
          }
          git push origin $BASE_BRANCH
